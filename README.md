<a name="A39WQ"></a>
## 概要
这是一个关于事项安排的WPF应用，涉及到WPF、Prism、RestSharp、Material Design和EF Core这些框架，数据库为SQLite，此外还使用到了AutoMapper库。
<a name="L8B8l"></a>
## 框架版本
![image.png](https://cdn.nlark.com/yuque/0/2022/png/34128965/1670146966684-9824026e-994e-4511-947e-0a2429c8fbec.png#averageHue=%232e2f34&clientId=u9bb4e07f-a4ca-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=449&id=u79995c47&margin=%5Bobject%20Object%5D&name=image.png&originHeight=449&originWidth=800&originalType=binary&ratio=1&rotation=0&showTitle=false&size=46357&status=done&style=none&taskId=ue8736483-3fc2-4581-aa79-009077e6116&title=&width=800)<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/34128965/1670146928019-89e40f2d-a7dd-4e56-8367-ff2342091e14.png#averageHue=%232d2f33&clientId=u9bb4e07f-a4ca-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=407&id=u9db83a56&margin=%5Bobject%20Object%5D&name=image.png&originHeight=407&originWidth=837&originalType=binary&ratio=1&rotation=0&showTitle=false&size=39375&status=done&style=none&taskId=uba8a6c69-2997-4044-92e9-02bac3ca260&title=&width=837)
<a name="SErHi"></a>
## 涉及知识
<a name="ryoqw"></a>
### 1.c#基础知识
[基础知识](https://learn.microsoft.com/zh-cn/dotnet/csharp/programming-guide/)
<a name="ehPYg"></a>
### 2.WPF
项目中使用到了一些控件，例如ListBox、ComboBox、DockPanel、StackPanel、WrapPanel、ContentCo-ntrol、TextBlock、Button、ToggleButton、Border、ScrollViewer、Canvas、ItemsControl等等
<a name="JPSa1"></a>
### 3.Prism
项目中引入Prism来实现MVVM（Model-View-ViewModel）模式，它的思想是用户和view进行交互，view界面里的数据和动作的响应在ViewModel中定义，而ViewModel里的数据又来自于后台逻辑，最后这一层抽象为Model层。<br />坦率的说Prism框架的内容很多，在本项目中只粗略的涉及到了数据绑定BindableBase，命令DelegateCo-mmand，区域Region，导航Navigation，时间聚合器EventAggregator，对话服务DialogService。
<a name="itVdR"></a>
### 4.Material Design
引入Material Design的主要目的是获得一些美观的样式组件，例如按钮、抽屉导航、动画效果、Snackbar等等
<a name="mqy7m"></a>
### 5.EF Core
客观的说，在本项目中并没有使用到EF Core的高级技术。在本项目中，自定义了一个MyToDoContext继承自EF Core提供的DbContext。一个DbContext的实例，是表示与数据库会话的一个实例，能够用来向数据库查询数据和保存数据。<br />在本项目中并没有直接使用DbContext来访问数据库获得数据实体Entity，而是将它和UnitOfWork联合起来。这样做的目的是以一种方便的方式，来保持业务层层面的事务一致性。<br />例如有这样一个业务请求，它对应的响应是新增一条事项（ToDo）记录，同时还要在另一张表中新增一条备忘录（Memo）记录。在结果上，两个新增记录操作必须要么都成功，要么都失败。如果其中一个操作失败，那么必须通过程序使得另一个操作动作不产生任何影响，亦即如果后者已经操作成功，那么也必须进行数据回退。此时，显然新增事项的操作应当在ToDoService里发起，而新增备忘录的操作应当在MemoService里发起。由于ToDoService和MemoService都是通过各自所持有的DbContext实例向数据库中发起新增操作，此时要保证两个新增记录操作必须要么都成功，要么都失败，就会变得非常困难。因为他们各自持有的DbContext实例并不是同一个。<br />为了克服这种困难，在项目中将DbContext和UnitOfWork联合起来使用，让UnitOfWork来持有一个DbContext实例，所有Service通过持有UnitOfWork，获取到不同数据实体对应的仓储对象Repository，满足业务层层面的事务一致性要求。例如：<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/34128965/1670168306814-eeabc451-5d5f-4d7b-8928-a4b5804c5462.png#averageHue=%23241f1e&clientId=u9bb4e07f-a4ca-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=288&id=u3910b798&margin=%5Bobject%20Object%5D&name=image.png&originHeight=288&originWidth=757&originalType=binary&ratio=1&rotation=0&showTitle=false&size=12567&status=done&style=none&taskId=ub08c78a6-87e7-4332-b080-7c839d7a06d&title=&width=757)
<a name="Zpg6x"></a>
### 6.Web API
在项目中，我们创建了一个ASP.NET Core  Web API项目，用于为WPF应用提供服务、处理请求。在 Web API项目中定义了一系列的Controllers来处理HTPP请求，他们都继承自ControllerBase而非Controller，因为本项目不涉及到处理 Web 页面。此外，还定义了一系列的Services供对应的Controller进行调用。当然，为了使得Controller能够拿到Service的实例，需要事先向容器进行注册这些Service。这些Service需要通过UnitOfWork获得数据库中的数据，因此还需要向容器配置、注册自定义的DbContext、UnitOfWork和Repository。
<a name="vaIgP"></a>
### 7.RestSharp
在项目中，引入RestSharp的目的是，在WPF应用里构造HTTP请求，请求Web API项目发回响应。
<a name="ETAEv"></a>
### 8.AutoMapper
在这里我们引入AutoMapper，它的作用是提供两个对象之间进行转换这样一种功能的支持。在项目中，通过DbContext返回的数据实体Entity，对应的是ToDo，Memo这些类。然而我们需要的数据对象还要支持和WPF的UI数据绑定，并且支持变更通知。因此，需要对Entity数据实体进行增强，在项目中再定义Dto类，使用这些Dto能够更好和WPF相互配合。例如Dto中在属性上的set访问器里有OnPropertyChanged()的变更通知功能。现在，在WPF中使用Dto，而通过 UnitOfWork返回却是Entity。为了使得Dto能存回数据库，那么需要将Dto转换成Entity，同时，从数据库返回的Entity需要转成Dto，方便和WPF配合，所以引入AutoMapper。
<a name="ZAuPl"></a>
## API接口
![image.png](https://cdn.nlark.com/yuque/0/2022/png/34128965/1670217334037-1717c437-8e6c-4f32-8e90-8af8666bcc6d.png#averageHue=%23e7f3c9&clientId=u056f6729-4cc1-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=921&id=u1aee0197&margin=%5Bobject%20Object%5D&name=image.png&originHeight=921&originWidth=1462&originalType=binary&ratio=1&rotation=0&showTitle=false&size=37477&status=done&style=none&taskId=ub7b24ee6-5863-4854-8b46-edd71218453&title=&width=1462)
<a name="KN3LU"></a>
## 界面截图
1.登陆界面<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/34128965/1670217433299-e6a7ffe5-1294-4c0d-bc41-f30981d72ab8.png#averageHue=%23faf7f2&clientId=u056f6729-4cc1-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=354&id=u976c9dd5&margin=%5Bobject%20Object%5D&name=image.png&originHeight=389&originWidth=616&originalType=binary&ratio=1&rotation=0&showTitle=false&size=39392&status=done&style=none&taskId=u1e998435-2ef8-45a0-980e-7e57c65a49d&title=&width=559.9999878623271)<br />2.登陆错误的Snackbar提示<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/34128965/1670217511188-5823f033-4b73-45bf-b76d-932f93c556d2.png#averageHue=%23f7f3ee&clientId=u056f6729-4cc1-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=354&id=u22763d09&margin=%5Bobject%20Object%5D&name=image.png&originHeight=389&originWidth=616&originalType=binary&ratio=1&rotation=0&showTitle=false&size=40232&status=done&style=none&taskId=uc6bcc211-3a59-48c6-b55e-421031dcdac&title=&width=559.9999878623271)<br />3.注册界面<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/34128965/1670217560930-9ec5a12e-8990-4452-918e-3b55422eb8a8.png#averageHue=%23faf7f2&clientId=u056f6729-4cc1-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=354&id=u4bcb471a&margin=%5Bobject%20Object%5D&name=image.png&originHeight=389&originWidth=616&originalType=binary&ratio=1&rotation=0&showTitle=false&size=40848&status=done&style=none&taskId=ud82d261a-6d3c-45b9-9795-627f416aa93&title=&width=559.9999878623271)<br />4.登陆成功后的主界面<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/34128965/1670218812947-c7a66408-a159-42cf-ab91-bb5b3e85147a.png#averageHue=%23f1a30b&clientId=u62e542a1-139c-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=698&id=u1221e7a4&margin=%5Bobject%20Object%5D&name=image.png&originHeight=768&originWidth=1280&originalType=binary&ratio=1&rotation=0&showTitle=false&size=68011&status=done&style=none&taskId=u4b48a2a1-36fb-463e-9958-1d490a76347&title=&width=1163.6363384152253)<br />5.弹出弹窗<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/34128965/1670218865298-3dd8f4fa-966b-48fd-bba7-eb97ca66be88.png#averageHue=%236e4704&clientId=u62e542a1-139c-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=698&id=uf10b1760&margin=%5Bobject%20Object%5D&name=image.png&originHeight=768&originWidth=1280&originalType=binary&ratio=1&rotation=0&showTitle=false&size=43664&status=done&style=none&taskId=u0151393f-8ea2-428d-9a26-da6428c2155&title=&width=1163.6363384152253)<br />6.提供数据正在处理效果，增加用户的体验感。例如在新增一条记录时，切换到其他页面时。<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/34128965/1670219350584-1c35d578-0075-420c-be3e-4b24e4080bb9.png#averageHue=%23e29409&clientId=u62e542a1-139c-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=695&id=ua33eac30&margin=%5Bobject%20Object%5D&name=image.png&originHeight=764&originWidth=1274&originalType=binary&ratio=1&rotation=0&showTitle=false&size=47871&status=done&style=none&taskId=ud3a35284-6122-4df4-bb33-4c3b5b35e96&title=&width=1158.1817930789039)<br />![1670219110(1).jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/34128965/1670219363122-94c40abb-bdca-4108-bbf0-7ed0335fd581.jpeg#averageHue=%23242424&clientId=u62e542a1-139c-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=698&id=u766f6a94&margin=%5Bobject%20Object%5D&name=1670219110%281%29.jpg&originHeight=768&originWidth=1280&originalType=binary&ratio=1&rotation=0&showTitle=false&size=24416&status=done&style=none&taskId=ubc872ab5-25f4-4a1f-a2bc-b8b3f790453&title=&width=1163.6363384152253)

7.左侧抽屉导航<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/34128965/1670218192948-b92c1e80-114c-4ebc-b557-e72045b7f846.png#averageHue=%2324211d&clientId=u62e542a1-139c-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=698&id=u01b32124&margin=%5Bobject%20Object%5D&name=image.png&originHeight=768&originWidth=1280&originalType=binary&ratio=1&rotation=0&showTitle=false&size=38506&status=done&style=none&taskId=u25cad2ff-f2e0-46d5-91cd-e3d609c8173&title=&width=1163.6363384152253)<br />8.事项页面，可以按照事项的类别给予不同的外观、查询和筛选事项、添加和删除事项<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/34128965/1670218244685-f671fbb8-71e5-4f02-926c-25eb87c2f47e.png#averageHue=%23303030&clientId=u62e542a1-139c-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=698&id=u6da04f63&margin=%5Bobject%20Object%5D&name=image.png&originHeight=768&originWidth=1280&originalType=binary&ratio=1&rotation=0&showTitle=false&size=23850&status=done&style=none&taskId=u00a1c236-c7b8-46d9-8e32-9f40c51556f&title=&width=1163.6363384152253)<br />9.单击事项弹出详情页<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/34128965/1670218369429-51658f5b-2b26-4c47-ab14-53b1e3dcd04a.png#averageHue=%231c1c1c&clientId=u62e542a1-139c-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=698&id=ub7274187&margin=%5Bobject%20Object%5D&name=image.png&originHeight=768&originWidth=1280&originalType=binary&ratio=1&rotation=0&showTitle=false&size=28145&status=done&style=none&taskId=u7c6b180d-029f-41e9-b375-28222d34c0a&title=&width=1163.6363384152253)

10.备忘录页和事项页相似<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/34128965/1670218459110-62f11d8e-0ff7-4565-8d89-6de6203dec30.png#averageHue=%23303030&clientId=u62e542a1-139c-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=698&id=ub3724102&margin=%5Bobject%20Object%5D&name=image.png&originHeight=768&originWidth=1280&originalType=binary&ratio=1&rotation=0&showTitle=false&size=18225&status=done&style=none&taskId=ub63fac24-554b-4527-945c-3cafd368bb6&title=&width=1163.6363384152253)
